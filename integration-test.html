<!DOCTYPE html>
<html>
<head>
    <title>CNC Calculator Tooltip Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f9fafb; }
        .result-card { background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin: 16px 0; }
        .tooltip-term { cursor: help; border-bottom: 1px dotted #6b7280; color: #374151; }
        .tooltip-term:hover { color: #2563eb; border-bottom-color: #2563eb; }
        .result-value { cursor: help; padding: 2px 4px; border-radius: 3px; }
        .result-value:hover { background-color: #dbeafe; }
        .result-card-header { cursor: pointer; padding: 8px; border-radius: 6px; }
        .result-card-header:hover { background-color: #f9fafb; }
    </style>
</head>
<body>
    <h1>CNC Calculator - Tooltip Integration Test</h1>
    <p>This demonstrates that tooltips work properly with dynamically generated content (like real calculation results).</p>
    
    <div id="results-container">
        <!-- Results will be dynamically generated here -->
    </div>
    
    <button onclick="generateNewResults()">Generate New Calculation Results</button>
    
    <script>
        // Simplified industry terms for testing
        const INDUSTRY_TERMS = {
            'RPM': { fullName: 'Revolutions Per Minute', description: 'Spindle speed', formula: 'RPM = (1000 × Vc) / (π × D)' },
            'Feed': { fullName: 'Feed Rate', description: 'Tool movement speed', formula: 'Feed = RPM × Z × fz' },
            'Chipload': { fullName: 'Feed per Tooth', description: 'Material thickness per tooth', formula: 'fz = Feed / (RPM × Flutes)' },
            'DOC': { fullName: 'Depth of Cut', description: 'Axial cutting depth', safetyNotes: 'Excessive DOC can break tools' },
            'Power': { fullName: 'Spindle Power', description: 'Required motor power', formula: 'P = SEC × MRR / η' }
        };
        
        // Tooltip creation function
        function createTooltip(element, content, type = 'basic') {
            const tooltip = document.createElement('div');
            tooltip.style.cssText = `
                position: absolute; background: white; border: 1px solid #e5e7eb; border-radius: 8px;
                padding: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 350px; z-index: 1000;
                font-size: 14px; display: none;
            `;
            
            if (type === 'term') {
                const term = INDUSTRY_TERMS[content];
                tooltip.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">
                        ${content} - ${term.fullName}
                    </div>
                    <div style="margin: 8px 0;">${term.description}</div>
                    ${term.formula ? `<div style="background: #f9fafb; padding: 8px; border-radius: 4px; font-family: monospace;"><strong>Formula:</strong> ${term.formula}</div>` : ''}
                    ${term.safetyNotes ? `<div style="background: #fef3c7; padding: 8px; margin-top: 8px; border-left: 3px solid #f59e0b; font-size: 12px;"><strong>⚠️ Safety:</strong> ${term.safetyNotes}</div>` : ''}
                `;
            } else if (type === 'parameter') {
                tooltip.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">${content.name}</div>
                    <div style="margin: 8px 0; height: 20px; background: linear-gradient(to right, #ef4444, #f59e0b, #10b981); border-radius: 10px; position: relative;">
                        <div style="position: absolute; left: 50%; top: 0; width: 8px; height: 100%; background: #2563eb; border: 2px solid white; margin-left: -4px; border-radius: 50%;"></div>
                    </div>
                    <div style="font-size: 12px; color: #6b7280;">Current: ${content.value} | Status: Good</div>
                `;
            }
            
            document.body.appendChild(tooltip);
            
            element.addEventListener('mouseenter', (e) => {
                tooltip.style.left = e.clientX + 10 + 'px';
                tooltip.style.top = e.clientY - 60 + 'px';
                tooltip.style.display = 'block';
            });
            
            element.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });
        }
        
        // Generate sample calculation results
        function generateNewResults() {
            const materials = ['Aluminum 6061-T6', 'Steel 1018', 'Stainless 304'];
            const cutTypes = ['Profile', 'Slot', 'Adaptive'];
            
            const resultsHtml = materials.map((material, i) => {
                const rpm = 12000 + i * 3000;
                const feed = 1200 + i * 400;
                const chipload = 0.04 + i * 0.02;
                const doc = 2.0 + i * 1.0;
                const power = 800 + i * 300;
                
                return `
                    <div class="result-card">
                        <div class="result-card-header" onclick="alert('Detailed calculations for ${material} would open here')">
                            <h3>${material} - ${cutTypes[i]}</h3>
                            <p style="color: #6b7280; font-size: 14px;">6mm End Mill • Click for detailed calculations</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
                            <div>
                                <span class="tooltip-term" data-term="RPM">RPM (n):</span>
                                <span class="result-value" data-param="rpm" data-value="${rpm}"> ${rpm.toLocaleString()}</span>
                            </div>
                            <div>
                                <span class="tooltip-term" data-term="Feed">Feed (Vf):</span>
                                <span class="result-value" data-param="feed" data-value="${feed}"> ${feed} mm/min</span>
                            </div>
                            <div>
                                <span class="tooltip-term" data-term="Chipload">Chipload (fz):</span>
                                <span class="result-value" data-param="chipload" data-value="${chipload}"> ${chipload.toFixed(3)} mm</span>
                            </div>
                            <div>
                                <span class="tooltip-term" data-term="DOC">DOC (ap):</span>
                                <span class="result-value" data-param="doc" data-value="${doc}"> ${doc.toFixed(1)} mm</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
                            <span class="tooltip-term" data-term="Power">Power (P):</span>
                            <span class="result-value" data-param="power" data-value="${power}"> ${power}W</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('results-container').innerHTML = resultsHtml;
            
            // Re-initialize tooltips after DOM update
            initializeTooltips();
        }
        
        function initializeTooltips() {
            // Clean up existing tooltips
            document.querySelectorAll('[data-tooltip-id]').forEach(tooltip => tooltip.remove());
            
            // Initialize term tooltips
            document.querySelectorAll('.tooltip-term').forEach(element => {
                const term = element.getAttribute('data-term');
                if (term && INDUSTRY_TERMS[term]) {
                    createTooltip(element, term, 'term');
                }
            });
            
            // Initialize parameter tooltips
            document.querySelectorAll('.result-value').forEach(element => {
                const param = element.getAttribute('data-param');
                const value = element.getAttribute('data-value');
                if (param && value) {
                    createTooltip(element, { name: param.toUpperCase(), value: value }, 'parameter');
                }
            });
        }
        
        // Initialize on page load
        generateNewResults();
    </script>
</body>
</html>